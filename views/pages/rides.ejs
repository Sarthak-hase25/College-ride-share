<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        h1, h2, h3 {
            font-family: 'Poppins', sans-serif;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#0F172A',
                        secondary: '#06B6D4',
                        accent: '#F59E0B',
                        dark: '#1E293B',
                        light: '#F1F5F9'
                    }
                }
            }
        }
    </script>
</head>
<body class="min-h-screen flex flex-col bg-light">
    <%- include('../partials/navbar') %>
    
    <main class="flex-grow py-12">
        <div class="container mx-auto px-4">
            <!-- Header -->
            <div class="text-center mb-8">
                <h1 class="text-4xl md:text-5xl font-bold text-primary mb-4">Available Rides</h1>
                <p class="text-gray-600 text-lg">Find your perfect ride and start saving!</p>
            </div>

            <!-- Search & Filter Form -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <form action="/rides" method="GET">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <!-- From -->
                        <div>
                            <label class="block text-gray-700 text-sm font-semibold mb-2" for="from">
                                From
                            </label>
                            <input 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent" 
                                id="from" 
                                name="from" 
                                type="text"
                                value="<%= filters && filters.from ? filters.from : '' %>"
                                placeholder="Enter location"
                            >
                        </div>

                        <!-- To -->
                        <div>
                            <label class="block text-gray-700 text-sm font-semibold mb-2" for="to">
                                To
                            </label>
                            <input 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent" 
                                id="to" 
                                name="to" 
                                type="text"
                                value="<%= filters && filters.to ? filters.to : '' %>"
                                placeholder="Enter destination"
                            >
                        </div>

                        <!-- Date -->
                        <div>
                            <label class="block text-gray-700 text-sm font-semibold mb-2" for="date">
                                Date
                            </label>
                            <input 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary focus:border-transparent" 
                                id="date" 
                                name="date" 
                                type="date"
                                value="<%= filters && filters.date ? filters.date : '' %>"
                            >
                        </div>

                        <!-- Buttons -->
                        <div class="flex gap-2 items-end">
                            <button 
                                type="submit"
                                class="flex-1 bg-secondary text-white font-semibold py-3 px-4 rounded-lg hover:bg-cyan-500 transition-all"
                            >
                                üîç Search
                            </button>
                            <a 
                                href="/rides"
                                class="bg-gray-200 text-gray-700 font-semibold py-3 px-4 rounded-lg hover:bg-gray-300 transition-all"
                            >
                                Clear
                            </a>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Results Count -->
            <% if (filters && (filters.from || filters.to || filters.date)) { %>
                <div class="mb-6">
                    <p class="text-gray-600">
                        Found <span class="font-bold text-secondary"><%= rides.length %></span> ride(s)
                    </p>
                </div>
            <% } %>

            <!-- Rides List -->
            <% if (rides && rides.length > 0) { %>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <% rides.forEach(ride => { %>
                        <div class="bg-white rounded-xl shadow-lg hover:shadow-2xl transition-all border-2 border-transparent hover:border-secondary p-6">
                            <!-- Route -->
                            <div class="mb-4">
                                <div class="flex items-center gap-3 mb-3">
                                    <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                    <div class="flex-1">
                                        <p class="text-sm text-gray-500">From</p>
                                        <p class="font-semibold text-gray-800"><%= ride.from %></p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-3">
                                    <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                                    <div class="flex-1">
                                        <p class="text-sm text-gray-500">To</p>
                                        <p class="font-semibold text-gray-800"><%= ride.to %></p>
                                    </div>
                                </div>
                            </div>

                            <!-- Date & Time -->
                            <div class="flex gap-4 mb-4 pb-4 border-b border-gray-200">
                                <div>
                                    <p class="text-xs text-gray-500">Date</p>
                                    <p class="font-semibold text-sm">
                                        <%= new Date(ride.date).toLocaleDateString('en-IN', { day: 'numeric', month: 'short' }) %>
                                    </p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-500">Time</p>
                                    <p class="font-semibold text-sm"><%= ride.time %></p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-500">Vehicle</p>
                                    <p class="font-semibold text-sm"><%= ride.vehicleType %></p>
                                </div>
                            </div>

                            <!-- Driver Info -->
                            <div class="mb-4">
                                <p class="text-xs text-gray-500 mb-1">Driver</p>
                                <p class="font-semibold text-gray-800"><%= ride.driver.name %></p>
                                <p class="text-sm text-gray-600"><%= ride.driver.college %></p>
                            </div>

                            <!-- Price & Seats -->
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <p class="text-2xl font-bold text-secondary">‚Çπ<%= ride.price %></p>
                                    <p class="text-xs text-gray-500">per seat</p>
                                </div>
                                <div class="text-right">
                                    <p class="text-lg font-bold text-gray-800"><%= ride.seats - ride.passengers.length %> / <%= ride.seats %></p>
                                    <p class="text-xs text-gray-500">seats left</p>
                                </div>
                            </div>

                            <!-- View Details Button -->
                            <a href="/rides/<%= ride._id %>" class="block w-full bg-secondary text-white text-center font-semibold py-3 rounded-lg hover:bg-cyan-500 transition-all">
                                View Details
                            </a>
                        </div>
                    <% }) %>
                </div>
            <% } else { %>
                <!-- No Rides Found -->
                <div class="text-center py-20">
                    <div class="text-6xl mb-4">üöó</div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">
                        <% if (filters && (filters.from || filters.to || filters.date)) { %>
                            No Rides Match Your Search
                        <% } else { %>
                            No Rides Available
                        <% } %>
                    </h3>
                    <p class="text-gray-600 mb-6">
                        <% if (filters && (filters.from || filters.to || filters.date)) { %>
                            Try adjusting your search filters
                        <% } else { %>
                            Be the first to offer a ride!
                        <% } %>
                    </p>
                    <div class="flex gap-4 justify-center">
                        <% if (filters && (filters.from || filters.to || filters.date)) { %>
                            <a href="/rides" class="inline-block bg-gray-200 text-gray-700 px-8 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-all">
                                Clear Filters
                            </a>
                        <% } %>
                        <a href="/rides/create" class="inline-block bg-secondary text-white px-8 py-3 rounded-lg font-semibold hover:bg-cyan-500 transition-all">
                            Offer a Ride
                        </a>
                    </div>
                </div>
            <% } %>
        </div>
    </main>
    
    <%- include('../partials/footer') %>

    <script>
        // Set minimum date to today
        document.getElementById('date').min = new Date().toISOString().split('T')[0];
    </script>
</body>
</html>